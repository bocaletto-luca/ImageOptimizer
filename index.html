<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>ImageOptimizer – Client-Side Image Compressor</title>
  <meta name="description" content="ImageOptimizer: compress and resize PNG, JPEG or WebP images entirely in the browser. Displays original and compressed dimensions & size, with download links.">
  <meta name="keywords" content="image compressor, client-side, browser, PNG, JPEG, WebP, resize, quality">
  <meta name="author" content="Bocaletto Luca">
  <link rel="canonical" href="https://bocaletto-luca.github.io/ImageOptimizer/index.html"/>

  <!-- Open Graph -->
  <meta property="og:title" content="ImageOptimizer – Client-Side Image Compressor"/>
  <meta property="og:description" content="Compress and resize images in your browser, view before/after dimensions & sizes."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://bocaletto-luca.github.io/ImageOptimizer/index.html"/>

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "ImageOptimizer",
    "url": "https://bocaletto-luca.github.io/ImageOptimizer/index.html",
    "description": "Compress and resize images in the browser with adjustable quality and dimensions.",
    "creator": {
      "@type": "Person",
      "name": "Bocaletto Luca",
      "url": "https://github.com/bocaletto-luca"
    },
    "applicationCategory": "Utilities"
  }
  </script>

  <style>
    :root {
      --bg: #f5f5f5;
      --card: #fff;
      --text: #333;
      --primary: #0066cc;
      --accent: #28a745;
      --border: #ccc;
    }
    [data-theme="dark"] {
      --bg: #1e1e1e;
      --card: #2c2c2c;
      --text: #ddd;
      --primary: #339af0;
      --accent: #5cb85c;
      --border: #555;
    }
    * { box-sizing:border-box; margin:0; padding:0; }
    body {
      display:flex; flex-direction:column; min-height:100vh;
      font-family:Arial,sans-serif; background:var(--bg); color:var(--text);
    }
    header, footer {
      background:var(--primary); color:#fff; text-align:center; padding:1rem;
    }
    main {
      flex:1; max-width:960px; width:100%; margin:1rem auto; padding:1rem;
    }
    #dropZone {
      border:2px dashed var(--border); border-radius:6px;
      padding:2rem; text-align:center; margin-bottom:1rem;
      background:var(--card); cursor:pointer;
    }
    #dropZone.dragover {
      border-color:var(--primary); color:var(--primary);
    }
    .controls {
      display:flex; flex-wrap:wrap; gap:.5rem; margin-bottom:1rem;
      align-items:flex-end;
    }
    .controls label {
      display:flex; flex-direction:column; font-size:.9rem;
    }
    .controls input,
    .controls select,
    .controls button {
      margin-top:.2rem; padding:.5rem; font-size:1rem;
      border:1px solid var(--border); border-radius:4px;
      background:var(--card); color:var(--text);
    }
    .controls button {
      background:var(--accent); color:#fff; border:none;
      cursor:pointer; transition:background .2s;
    }
    .controls button:hover { background: #218838; }
    #gallery {
      display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
      gap:1rem;
    }
    .card {
      background:var(--card); border-radius:6px;
      padding:1rem; box-shadow:0 2px 4px rgba(0,0,0,0.1);
    }
    .card img {
      max-width:100%; display:block; border-radius:4px;
    }
    .info {
      margin-top:.5rem; font-size:.9rem; line-height:1.3;
      color:var(--text);
    }
    .info span { display:block; }
    .info a.download {
      display:inline-block; margin-top:.5rem;
      color:var(--primary); text-decoration:underline;
      cursor:pointer;
    }
  </style>
</head>
<body data-theme="light">
  <header>
    <h1>ImageOptimizer</h1>
    <p>Compress &amp; Resize Images in the Browser</p>
  </header>

  <main>
    <div id="dropZone">Click or Drag &amp; Drop Images Here</div>

    <div class="controls">
      <label>
        Output Format
        <select id="formatSelect">
          <option value="image/jpeg">JPEG</option>
          <option value="image/png">PNG</option>
          <option value="image/webp">WebP</option>
        </select>
      </label>

      <label>
        Quality: <span id="qualityValue">0.8</span>
        <input type="range" id="qualityRange" min="0.1" max="1" step="0.05" value="0.8"/>
      </label>

      <label>
        Max Width (px)
        <input type="number" id="maxWidth" placeholder="e.g. 800" min="1"/>
      </label>

      <button id="compressBtn">Compress All</button>
      <button id="clearBtn">Clear All</button>
      <button id="themeBtn">🌙 Dark Mode</button>
      <input type="file" id="fileInput" accept="image/*" multiple style="display:none"/>
    </div>

    <div id="gallery"></div>
  </main>

  <footer>
    © 2025 Bocaletto Luca | 
    <a href="https://github.com/bocaletto-luca/ImageOptimizer" target="_blank" rel="noopener">Repository</a>
  </footer>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const dropZone    = document.getElementById('dropZone');
    const fileInput   = document.getElementById('fileInput');
    const gallery     = document.getElementById('gallery');
    const formatSel   = document.getElementById('formatSelect');
    const qualityRng  = document.getElementById('qualityRange');
    const qualityVal  = document.getElementById('qualityValue');
    const maxWidthIn  = document.getElementById('maxWidth');
    const compressBtn = document.getElementById('compressBtn');
    const clearBtn    = document.getElementById('clearBtn');
    const themeBtn    = document.getElementById('themeBtn');
    const body        = document.body;

    let files = [];

    // Theme toggle
    themeBtn.addEventListener('click', () => {
      const theme = body.dataset.theme === 'light' ? 'dark' : 'light';
      body.dataset.theme = theme;
      themeBtn.textContent = theme === 'dark' ? '☀️ Light Mode' : '🌙 Dark Mode';
    });

    // Quality display
    qualityRng.addEventListener('input', () => {
      qualityVal.textContent = qualityRng.value;
    });

    // Open file picker
    dropZone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', e => handleFiles(e.target.files));

    // Drag & drop styling
    ['dragenter','dragover'].forEach(evt => {
      dropZone.addEventListener(evt, e => {
        e.preventDefault(); dropZone.classList.add('dragover');
      });
    });
    ['dragleave','drop'].forEach(evt => {
      dropZone.addEventListener(evt, e => {
        e.preventDefault(); dropZone.classList.remove('dragover');
      });
    });
    dropZone.addEventListener('drop', e => {
      handleFiles(e.dataTransfer.files);
    });

    // Clear all
    clearBtn.addEventListener('click', () => {
      files = [];
      gallery.innerHTML = '';
    });

    function handleFiles(fileList) {
      for (let f of fileList) {
        if (f.type.startsWith('image/')) files.push(f);
      }
      renderGallery();
    }

    function renderGallery() {
      gallery.innerHTML = '';
      files.forEach((file, i) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="" alt="preview"/>
          <div class="info">
            <span><strong>${file.name}</strong></span>
            <span>Original: <span class="orig-dims"></span>, <span class="orig-size"></span></span>
            <span class="res-info"></span>
          </div>`;
        gallery.appendChild(card);

        // Load preview and original metadata
        const img = card.querySelector('img');
        const origDims = card.querySelector('.orig-dims');
        const origSize = card.querySelector('.orig-size');
        const reader = new FileReader();
        reader.onload = () => {
          img.src = reader.result;
          const temp = new Image();
          temp.onload = () => {
            origDims.textContent = `${temp.width}px × ${temp.height}px`;
            origSize.textContent = `${(file.size/1024).toFixed(1)} KB`;
          };
          temp.src = reader.result;
        };
        reader.readAsDataURL(file);
      });
    }

    compressBtn.addEventListener('click', async () => {
      const format = formatSel.value;
      const quality = parseFloat(qualityRng.value);
      const maxW = parseInt(maxWidthIn.value) || null;

      for (let i = 0; i < files.length; i++) {
        await compressOne(files[i], i, format, quality, maxW);
      }
    });

    function compressOne(file, index, format, quality, maxW) {
      return new Promise(resolve => {
        const card = gallery.children[index];
        const img = new Image();
        const info = card.querySelector('.res-info');
        const reader = new FileReader();

        reader.onload = () => {
          img.onload = () => {
            // compute dimensions
            const w = maxW && img.width > maxW ? maxW : img.width;
            const h = img.height * (w / img.width);

            // draw on canvas
            const canvas = document.createElement('canvas');
            canvas.width = w; canvas.height = h;
            canvas.getContext('2d').drawImage(img, 0, 0, w, h);

            // blob
            canvas.toBlob(blob => {
              const url = URL.createObjectURL(blob);
              card.querySelector('img').src = url;

              // result info
              const sizeKB = (blob.size/1024).toFixed(1);
              info.textContent = `Compressed: ${w}px × ${h}px, ${sizeKB} KB`;

              // download link
              let dl = card.querySelector('a.download');
              if (!dl) {
                dl = document.createElement('a');
                dl.className = 'download';
                dl.textContent = 'Download';
                card.querySelector('.info').appendChild(dl);
              }
              const ext = format.split('/')[1].replace('jpeg','jpg');
              const base = file.name.replace(/\.[^/.]+$/,'');
              dl.href = url;
              dl.download = `optimized-${base}.${ext}`;

              resolve();
            }, format, quality);
          };
          img.src = reader.result;
        };

        reader.readAsDataURL(file);
      });
    }
  });
  </script>
</body>
</html>
